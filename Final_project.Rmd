---
title: "final_project_419"
author: "Tyler Chun"
date: "11/24/2021"
output: pdf_document
---

## Approach: Remove point 8 and Treat Speed as numeric and Box-cox

- Treat Speed as numeric

- Transformation of response

## 1. Import the data and clean the data set to fit into the model

```{r}
df = read.csv("df.csv")

# Do initial Analysis and fit model
Response = c(df$Replicate.1,df$Replicate.2,df$Replicate.3)

# Change Speed to original speed numbers
df$Speed_f=as.factor(df$Speed)

df$Speed[df$Speed_f==1]=50
df$Speed[df$Speed_f==2]=30
df$Speed[df$Speed_f==3]=10
df$Speed[df$Speed_f==4]=2.5
df$Speed = as.factor(df$Speed)
df$Device = as.factor(df$Device)
df$Browser = as.factor(df$Browser)
new_df = 
data.frame(Device = rep(df$Device,3),
Speed = rep(df$Speed,3),
Browser = rep(df$Browser,3),
Response,
replicate = as.factor(c(rep(1,24),rep(2,24),rep(3,24))))
```

## 1.1 EDA

```{r}
par(mfrow=c(2,3))
plot(data= new_df, Response~ as.numeric(Device) + as.numeric(Speed)+as.numeric(Browser))
plot(data= new_df, Response~ (Device) + (Speed)+(Browser))
```

## 2. Fit into the model and Check the model with the model Assumptions and Tukey

```{r}
m1 <-lm(data=new_df, Response~(Device + Speed + Browser)^2 + replicate)
summary(m1)

anova(m1)

par(mfrow=c(1,2))
plot(m1,c(1,2))

par(mfrow=c(2,2))
plot(TukeyHSD(aov(m1)),las=2)

TukeyHSD(aov(m1))
```

## 3. Boxcox Transformation


```{r}
library(MASS)
new_df_8_deleted <- new_df[-8,]
new_df_8_deleted$Speed <- as.numeric(as.character(new_df_8_deleted$Speed))
m1.1 <-lm(data=new_df_8_deleted, Response~(Device + Speed + Browser)^2 + replicate)

# To see the exact best lambda:
lmod1_bc <- boxcox(m1.1)
lambda <- lmod1_bc$x[which.max(lmod1_bc$y)]


#2. We see the best lambda is 0.3030303, round to 0.3. Create a new transformed response using Box-Cox 
#lambda is -0.747474747474747, not 0.3030303
paste0("lambda is ",lambda)
new_df_8_deleted['Response_t'] <- (new_df_8_deleted$Response^lambda - 1) / lambda
```

## 3.1 Fit the model after transformation and 

```{r}
m2 <-lm(data=new_df_8_deleted, Response_t~(Device + Speed + Browser)^2 + replicate)
summary(m2)

anova(m2)

# Cook's distance
par(mfrow=c(1,1))
plot(m2,4)

# Residual vs Fitted
par(mfrow=c(1,2))
plot(m2,c(1,2))

# Interaction plots
y_bar = (df$Replicate.1 + df$Replicate.2 + df$Replicate.3)/3
interaction.plot(df$Device, df$Speed, y_bar)
interaction.plot(df$Device, df$Browser, y_bar)
interaction.plot(df$Browser, df$Speed, y_bar)
```
